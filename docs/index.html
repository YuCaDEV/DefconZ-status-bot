<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Estado del Servidor DefconZ</title>
  <style>
      @import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Share+Tech+Mono&display=swap");

      :root {
        color-scheme: dark;
        --bg: #0b0d10;
        --panel: #12151c;
        --panel-soft: #1a1f2b;
        --accent: #e54646;
        --accent-soft: #ff6b3d;
        --success: #3bd66f;
        --text: #e6e8ef;
        --muted: #9aa0ad;
        --border: rgba(255, 255, 255, 0.08);
        --glow: rgba(229, 70, 70, 0.35);
        --font-sans: "Space Grotesk", "Inter", system-ui, -apple-system, sans-serif;
        --font-mono: "Share Tech Mono", "Space Mono", monospace;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: clamp(1.5rem, 5vw, 3.5rem);
        background: radial-gradient(circle at 20% 20%, rgba(229, 70, 70, 0.05), transparent 32%),
          radial-gradient(circle at 78% 12%, rgba(255, 107, 61, 0.08), transparent 28%),
          var(--bg);
        color: var(--text);
        font-family: var(--font-sans);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background: repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.012) 0,
            rgba(255, 255, 255, 0.012) 1px,
            transparent 1px,
            transparent 4px
          ),
          repeating-linear-gradient(
            0deg,
            rgba(255, 255, 255, 0.01) 0,
            rgba(255, 255, 255, 0.01) 1px,
            transparent 1px,
            transparent 4px
          );
        mix-blend-mode: soft-light;
        opacity: 0.55;
        z-index: 0;
      }

      main {
        position: relative;
        z-index: 1;
        width: min(1200px, 100%);
        padding: clamp(2.6rem, 6.5vw, 3.8rem);
        border-radius: 28px;
        border: 1px solid var(--border);
        background: linear-gradient(135deg, rgba(229, 70, 70, 0.07), rgba(26, 31, 43, 0.95));
        backdrop-filter: blur(16px);
        box-shadow: 0 36px 78px rgba(0, 0, 0, 0.48), 0 0 0 1px rgba(255, 255, 255, 0.04);
      }

      .top-action {
        position: absolute;
        top: clamp(1rem, 3vw, 1.6rem);
        right: clamp(1rem, 3vw, 1.6rem);
        z-index: 2;
        display: flex;
        align-items: center;
        gap: 0.85rem;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .top-action a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        padding: 0.55rem 1.35rem;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: linear-gradient(135deg, #ff6151, #ff7650);
        color: #0b0d10;
        font-weight: 700;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        font-size: 0.9rem;
        text-decoration: none;
        box-shadow: 0 12px 26px rgba(255, 97, 81, 0.35);
        transition: transform 0.15s ease, box-shadow 0.2s ease;
      }

      .top-action a:hover {
        transform: translateY(-2px);
        box-shadow: 0 18px 34px rgba(255, 97, 81, 0.45);
      }

      .top-action a:active {
        transform: translateY(0);
        box-shadow: 0 8px 18px rgba(255, 97, 81, 0.35);
      }

      h1 {
        margin: 0 0 1.5rem;
        font-size: clamp(2.2rem, 4.5vw, 3.2rem);
        font-weight: 700;
        letter-spacing: 0.08em;
        text-align: center;
        text-transform: uppercase;
      }

      h1 span {
        display: inline-block;
        background: linear-gradient(135deg, var(--accent), var(--accent-soft));
        -webkit-background-clip: text;
        color: transparent;
        text-shadow: 0 12px 32px rgba(229, 70, 70, 0.35);
      }

      .card {
        position: relative;
        border-radius: 18px;
        padding: clamp(1.7rem, 3.6vw, 2.4rem);
        background: rgba(18, 21, 28, 0.88);
        display: grid;
        gap: 1.4rem;
        border: 1px solid var(--border);
        box-shadow: 0 20px 45px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        width: 100%;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: -32% -40% auto;
        height: 200px;
        background: radial-gradient(circle, var(--glow), transparent 65%);
        opacity: 0.45;
        pointer-events: none;
      }

      .card > * {
        position: relative;
        z-index: 1;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.2rem;
        flex-wrap: wrap;
      }

      .server-title {
        flex: 1;
        text-align: center;
      }

      .server-label {
        display: block;
        font-size: 0.75rem;
        letter-spacing: 0.15em;
        color: var(--muted);
        text-transform: uppercase;
        margin-bottom: 0.35rem;
      }

            .card h2 {
        margin: 0;
        font-size: clamp(1.25rem, 2vw, 1.95rem);
        font-weight: 700;
        text-align: center;
        max-width: 100%;
        white-space: normal;
        line-height: 1.2;
      }

      .card.loading {
        text-align: center;
        color: var(--muted);
        font-style: italic;
      }

      .status-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.4rem 1rem;
        border-radius: 999px;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(26, 31, 43, 0.8);
      }

      .status-dot {
        width: 0.65rem;
        height: 0.65rem;
        border-radius: 50%;
        background: currentColor;
        box-shadow: 0 0 12px currentColor;
      }

      .status-online {
        background: rgba(59, 214, 111, 0.16);
        color: #50f5a6;
        border-color: rgba(80, 245, 166, 0.35);
      }

      .status-offline {
        background: rgba(229, 70, 70, 0.2);
        color: #ff9393;
        border-color: rgba(229, 70, 70, 0.45);
      }

      dl.detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1.4rem 1.8rem;
        margin: 0;
        margin-top: clamp(1.6rem, 3vw, 2.1rem);
      }

      dl.detail-grid div {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      dt {
        color: var(--muted);
        font-size: 0.78rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      dd {
        margin: 0;
        font-size: clamp(0.95rem, 1.7vw, 1.22rem);
        font-weight: 600;
        color: var(--text);
        font-family: var(--font-mono);
      }

      .detail-large dd {
        font-size: clamp(1.35rem, 3vw, 1.9rem);
        font-weight: 700;
        color: #ffffff;
      }

      button.refresh {
        margin: 2.2rem auto 0;
        display: block;
        padding: 0.8rem 2.6rem;
        border-radius: 999px;
        border: 1px solid transparent;
        font-weight: 600;
        letter-spacing: 0.05em;
        cursor: pointer;
        font-size: 1rem;
        background: linear-gradient(135deg, var(--accent), var(--accent-soft));
        color: #0b0d10;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
        box-shadow: 0 20px 40px rgba(229, 70, 70, 0.35);
      }

      button.refresh:hover {
        transform: translateY(-2px);
        box-shadow: 0 26px 48px rgba(229, 70, 70, 0.45);
      }

      .logo {
        display: block;
        margin: clamp(1.8rem, 3.2vw, 2.4rem) auto 0;
        max-width: 210px;
        width: 48%;
        filter: drop-shadow(0 18px 36px var(--glow));
      }

      .copy-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.4rem 0.95rem;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.28);
        background: rgba(26, 31, 43, 0.7);
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease-in-out, transform 0.12s;
        white-space: nowrap;
        font-family: var(--font-mono);
        font-size: 0.95rem;
      }

      .copy-button:hover {
        background: rgba(229, 70, 70, 0.24);
        transform: translateY(-1px);
      }

      .copy-button.copied {
        background: rgba(59, 214, 111, 0.24);
        border-color: rgba(59, 214, 111, 0.45);
        color: #d9ffe8;
      }

      .error {
        color: #ff8c8c;
        text-align: center;
        font-weight: 600;
      }

      footer {
        margin-top: clamp(1.6rem, 3vw, 2.2rem);
        text-align: center;
        color: var(--muted);
        font-size: 0.92rem;
      }

      footer a {
        color: var(--accent-soft);
        font-weight: 600;
      }

      @media (max-width: 600px) {
        main {
          padding: 2rem 1.4rem;
        }

        dl.detail-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        h1 {
          letter-spacing: 0.05em;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <div class="top-action">
        <a href="https://ycod3v.github.io/DefconZ/">
          Inicio
        </a>
        <a class="join-button" href="https://discord.com/invite/PFqDrEvUzW" target="_blank" rel="noopener">
          Únete
        </a>
      </div>
      <h1>Estado del Servidor - <span>DefconZ</span></h1>

      <section id="status" class="card loading">Cargando datos del servidor…</section>

      <button type="button" class="refresh" id="refresh">Actualizar ahora</button>
      <img src="logo2.png" alt="DefconZ" class="logo">

      <footer>
        <span id="updated">Última actualización: --</span><br>
        Fuente: <a href="https://www.battlemetrics.com/" target="_blank" rel="noopener">BattleMetrics</a>
        • Crafted by Yu &#9829;
      </footer>
    </main>

    <script>
      const API_BASE = "https://api.battlemetrics.com/servers";
      const DEFAULT_SERVER_ID = "33716617";
      const REFRESH_INTERVAL_MS = 5 * 60 * 1000;

      const statusSection = document.getElementById("status");
      const updatedLabel = document.getElementById("updated");
      const refreshButton = document.getElementById("refresh");

      // Small helper to normalize optional values so the UI stays clean.
      function formatValue(value, fallback = "-") {
        if (value === null || value === undefined || value === "") {
          return fallback;
        }
        return value;
      }

      function renderLoading() {
        statusSection.className = "card loading";
        statusSection.textContent = "Actualizando datos…";
      }

      function renderError(message) {
        statusSection.className = "card";
        statusSection.innerHTML = `<div class="error">${message}</div>`;
      }

      function renderServer(serverData) {
        const attrs = serverData.attributes;
        const details = attrs.details || {};
        const serverName = formatValue(attrs.name, "Servidor sin nombre").replace(/\s*\n\s*/g, " ");
        const statusClass = attrs.status === "online" ? "status-online" : "status-offline";
        const formattedIp = formatValue(attrs.ip, "N/D");
        const formattedPort = formatValue(attrs.port, "-");
        const address = `${String(formattedIp).trim()}:${String(formattedPort).trim()}`;
        const gameIdRaw = serverData.relationships?.game?.data?.id;
        const formattedGame = formatValue(gameIdRaw, "DayZ");
        const displayGame = typeof formattedGame === "string" && formattedGame.toLowerCase() === "dayz"
          ? "DayZ"
          : formattedGame;
        const statusLabel = attrs.status ? attrs.status.toUpperCase() : "DESCONOCIDO";

        statusSection.className = "card";
        statusSection.innerHTML = `
          <header class="card-header">
            <span class="status-chip ${statusClass}">
              <span class="status-dot" aria-hidden="true"></span>
              ${statusLabel}
            </span>
            <div class="server-title">
              <span class="server-label">Servidor</span>
              <h2>${serverName}</h2>
            </div>
          </header>
          <dl class="detail-grid">
            <div class="detail-large">
              <dt>Jugadores</dt>
              <dd>${formatValue(attrs.players, 0)} / ${formatValue(attrs.maxPlayers, "?")}</dd>
            </div>
            <div>
              <dt>Dirección IP</dt>
              <dd>
                <button type="button" class="copy-button" data-copy="${address}">
                  ${address}
                </button>
              </dd>
            </div>
            <div>
              <dt>Mapa</dt>
              <dd>${formatValue(details.map, "DeerIsle")}</dd>
            </div>
            <div>
              <dt>Game</dt>
              <dd>${displayGame}</dd>
            </div>
            <div>
              <dt>Rank</dt>
              <dd>${formatValue(attrs.rank, "-")}</dd>
            </div>
          </dl>
        `;
      }

      async function fetchByServerId(serverId) {
        const response = await fetch(`${API_BASE}/${encodeURIComponent(serverId)}`);
        if (!response.ok) {
          throw new Error("No se pudo cargar el servidor.");
        }
        const json = await response.json();
        return json.data;
      }

      async function fetchBySearch(query) {
        const response = await fetch(`${API_BASE}?filter[search]=${encodeURIComponent(query)}`);
        if (!response.ok) {
          throw new Error("No se pudo realizar la búsqueda en BattleMetrics.");
        }
        const json = await response.json();
        if (!json.data || json.data.length === 0) {
          throw new Error("No se encontraron servidores con esa búsqueda.");
        }
        return json.data[0];
      }

      async function updateStatus() {
        try {
          renderLoading();
          const params = new URLSearchParams(window.location.search);
          const requestedServerId = params.get("serverId");
          const serverId = requestedServerId && requestedServerId.trim() !== ""
            ? requestedServerId.trim()
            : null;
          const searchParam = params.get("search");
          const searchQuery = searchParam && searchParam.trim() !== ""
            ? searchParam.trim()
            : null;

          const serverData = serverId
            ? await fetchByServerId(serverId)
            : searchQuery
              ? await fetchBySearch(searchQuery)
              : await fetchByServerId(DEFAULT_SERVER_ID);

          renderServer(serverData);
          const timestamp = new Date().toLocaleString("es-CL", {
            hour12: false,
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
            day: "2-digit",
            month: "2-digit"
          });
          updatedLabel.textContent = `Última actualización: ${timestamp}`;
        } catch (error) {
          renderError(error.message || "Error inesperado al cargar el estado.");
        }
      }

      refreshButton.addEventListener("click", updateStatus);
      statusSection.addEventListener("click", async (event) => {
        const target = event.target instanceof HTMLElement
          ? event.target.closest(".copy-button")
          : null;

        if (!(target instanceof HTMLButtonElement)) {
          return;
        }

        const value = target.getAttribute("data-copy") || "";
        try {
          await navigator.clipboard.writeText(value);
          const originalLabel = target.getAttribute("data-label") || target.textContent?.trim() || value;
          target.setAttribute("data-label", originalLabel);
          target.textContent = "Copiado";
          target.classList.add("copied");
          setTimeout(() => {
            target.textContent = target.getAttribute("data-label") || value;
            target.classList.remove("copied");
          }, 1500);
        } catch (error) {
          target.classList.add("error");
        }
      });

      updateStatus();
      setInterval(updateStatus, REFRESH_INTERVAL_MS);
    </script>
  </body>
</html>
